# Security Chapter Extract
Book: Michael Kofler - Scripting_ Automation with Bash, PowerShell, and Python (2024, Rheinwerk Publishing) - libgen.li
Chapter: 3 - , Section 3.9). The -T option prevents ssh from opening a pseudo-terminal, which is not desirable in this case because the execution of commands should not be interactive.
ssh -T root@host <<ENDSSHrm -f /etc/file1cp /root/file2 /userxy/file3...ENDSSH 
The first time you establish an SSH connection to a new host, ssh asks if you trust the host. Normally, this query is useful. However, if you want to use ssh to perform automated work on multiple hosts or virtual machines, this query is interference. The solution in such cases is the -oStrictHostKeyChecking=no option.
12.2.4    Running Windows Commands
Command execution also works for Windows hosts, although the syntactic varieties are much smaller for Windows. Provided that you have set PowerShell as the default shell (Section 12.1), you can run a command via SSH.
$ ssh user@winhost 'Get-ChildItem C:\\'  user@winhost's password: **********  Directory: C:\  Mode           LastWriteTime    Name  ----    --------------------    ----  d-r--    02.17.2023    08:20    Program Files  d-r--    02.17.2023    08:20    Program Files (x86)  d-r--    07.13.2022    04:02    Users  d----    02.20.2023    04:13    Windows 
12.2.5    SSH Remoting in PowerShell
You can use the Enter-PSSession or New-PSSession commands to run commands on external Windows computers via Windows Remote Management. Since PowerShell 6, this feature is also available for SSH connections and is accordingly referred to as SSH remoting. Previously, however, some preparatory work was required on the server side.
To use SSH remoting on an external Windows machine, a new Subsystem line must be added to the respective sshd_config file. The Subsystem statement is spread over two lines in our case with \ only for space reasons. (It must be specified in one line and without the \ character!) According to the documentation, the -nologo option will no longer be required as of PowerShell version 7.4.
# Windows host: File $env:ProgramData\ssh\sshd_config...Subsystem powershell c:/progra~1/powershell/7/pwsh.exe \  -sshs -nologo 
The easiest way to open the file is to start the editor from the terminal (e.g., using code $env:ProgramData\ssh\sshd_config). This approach will automatically replace $env:ProgramData with the appropriate path on your machine (usually C:\ProgramData).  
The strange Subsystem setting c:/progra~1/powershell/7/pwsh.exe is the usual path to the PowerShell installation in DOS notation (i.e., with a maximum of 8 plus 3 characters per filename or directory name). This ancient notation is necessary because OpenSSH cannot handle Windows filenames with spaces.
Possibly the correct path is also c:/progra~2! The following commands show how you can find out the short notation. First, you want to use Get-Command to determine the installation location of PowerShell. Then, you must run cmd.exe to get the short notation of the program directory:
> (Get-Command pwsh).Path  C:\Program Files (x86)\PowerShell\7\pwsh.exe> cmd /c 'for %X in ("C:\Program Files (x86)") do @echo %~sX'  C:\PROGRA~2 
Finally, you need to restart the SSH server: 
> Restart-Service sshd 
The preparatory work for using a Linux machine for SSH remoting looks quite similar. On Linux, you must also add a Subsystem line to sshd_config. However, instead of /usr/bin/pwsh, you must use the path to PowerShell that is valid in your distribution. You can determine the path via which pwsh.
# Linux host: File /etc/ssh/sshd_config...Subsystem powershell /usr/bin/pwsh -sshs -nologo 
The following command restarts the SSH server:
$ sudo systemctl restart sshd 
Once you have completed this preparatory work, you can use New-PSSession  to establish an SSH connection and use it as a parameter for Invoke-Command. For the following example, I worked locally on a Windows machine, connecting to the Linux machine on the network and running Get-ChildItem there. You can use Remove-PSSession to terminate the SSH connection.
> $session = New-PSSession linuxhostname -Username kofler> Invoke-Command -Session $session { Get-ChildItem /etc/*.conf }  Directory: /etc  Mode         LastWriteTime    Length Name  ----         -------------    ------ ----  --r--  02/10/2023    22:08       833 appstream.conf  --r--  01/27/2023    19:44         0 arptables.conf  --r--  12/06/2021    13:27      1438 dhcpcd.conf> Remove-PSSession $session 
Further configuration tips and application examples can be found at the following links:
Security Relevance Score: 2
Word Count: 774
Extracted: 2025-06-13 23:41:06

---

, Section 3.9). The -T option prevents ssh from opening a pseudo-terminal, which is not desirable in this case because the execution of commands should not be interactive.
ssh -T root@host <<ENDSSHrm -f /etc/file1cp /root/file2 /userxy/file3...ENDSSH 
The first time you establish an SSH connection to a new host, ssh asks if you trust the host. Normally, this query is useful. However, if you want to use ssh to perform automated work on multiple hosts or virtual machines, this query is interference. The solution in such cases is the -oStrictHostKeyChecking=no option.
12.2.4    Running Windows Commands
Command execution also works for Windows hosts, although the syntactic varieties are much smaller for Windows. Provided that you have set PowerShell as the default shell (Section 12.1), you can run a command via SSH.
$ ssh user@winhost 'Get-ChildItem C:\\'  user@winhost's password: **********  Directory: C:\  Mode           LastWriteTime    Name  ----    --------------------    ----  d-r--    02.17.2023    08:20    Program Files  d-r--    02.17.2023    08:20    Program Files (x86)  d-r--    07.13.2022    04:02    Users  d----    02.20.2023    04:13    Windows 
12.2.5    SSH Remoting in PowerShell
You can use the Enter-PSSession or New-PSSession commands to run commands on external Windows computers via Windows Remote Management. Since PowerShell 6, this feature is also available for SSH connections and is accordingly referred to as SSH remoting. Previously, however, some preparatory work was required on the server side.
To use SSH remoting on an external Windows machine, a new Subsystem line must be added to the respective sshd_config file. The Subsystem statement is spread over two lines in our case with \ only for space reasons. (It must be specified in one line and without the \ character!) According to the documentation, the -nologo option will no longer be required as of PowerShell version 7.4.
# Windows host: File $env:ProgramData\ssh\sshd_config...Subsystem powershell c:/progra~1/powershell/7/pwsh.exe \  -sshs -nologo 
The easiest way to open the file is to start the editor from the terminal (e.g., using code $env:ProgramData\ssh\sshd_config). This approach will automatically replace $env:ProgramData with the appropriate path on your machine (usually C:\ProgramData).  
The strange Subsystem setting c:/progra~1/powershell/7/pwsh.exe is the usual path to the PowerShell installation in DOS notation (i.e., with a maximum of 8 plus 3 characters per filename or directory name). This ancient notation is necessary because OpenSSH cannot handle Windows filenames with spaces.
Possibly the correct path is also c:/progra~2! The following commands show how you can find out the short notation. First, you want to use Get-Command to determine the installation location of PowerShell. Then, you must run cmd.exe to get the short notation of the program directory:
> (Get-Command pwsh).Path  C:\Program Files (x86)\PowerShell\7\pwsh.exe> cmd /c 'for %X in ("C:\Program Files (x86)") do @echo %~sX'  C:\PROGRA~2 
Finally, you need to restart the SSH server: 
> Restart-Service sshd 
The preparatory work for using a Linux machine for SSH remoting looks quite similar. On Linux, you must also add a Subsystem line to sshd_config. However, instead of /usr/bin/pwsh, you must use the path to PowerShell that is valid in your distribution. You can determine the path via which pwsh.
# Linux host: File /etc/ssh/sshd_config...Subsystem powershell /usr/bin/pwsh -sshs -nologo 
The following command restarts the SSH server:
$ sudo systemctl restart sshd 
Once you have completed this preparatory work, you can use New-PSSession  to establish an SSH connection and use it as a parameter for Invoke-Command. For the following example, I worked locally on a Windows machine, connecting to the Linux machine on the network and running Get-ChildItem there. You can use Remove-PSSession to terminate the SSH connection.
> $session = New-PSSession linuxhostname -Username kofler> Invoke-Command -Session $session { Get-ChildItem /etc/*.conf }  Directory: /etc  Mode         LastWriteTime    Length Name  ----         -------------    ------ ----  --r--  02/10/2023    22:08       833 appstream.conf  --r--  01/27/2023    19:44         0 arptables.conf  --r--  12/06/2021    13:27      1438 dhcpcd.conf> Remove-PSSession $session 
Further configuration tips and application examples can be found at the following links:


https://learn.microsoft.com/en-us/powershell/scripting/learn/remoting/ssh-remoting-in-powershell-core


https://github.com/PowerShell/Win32-OpenSSH/issues/1498











12.3    scp and rsync
scp enables you to copy a file back and forth between a local computer and a remote computer. The following lines summarize the main syntax variants of scp. Unlike the ssh command, the hostname must always be followed by a colon! Remember: The dot (.) is the short notation for the current directory.
# copy local file to an external host (upload)$ scp filename user@host:$ scp filename user@host:path/newfilename# copy the file of the external host into the local# file system (download)$ scp user@host:filename .$ scp user@host:path/filename .# copy entire directory trees recursively$ scp -r localdir/ user@host:$ scp -r user@host:remotedir . 

Annoying Password Specification
Even if not included in our listings for space reasons, each scp command must be acknowledged by entering a password, which is, of course, annoying. The solution in this case is to use an SSH key (
